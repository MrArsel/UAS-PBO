{% load static %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Sistem Peminjaman Barang</title>
    <link rel="icon" href="{% static 'img/prima.png' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="logo">Peminjaman.id</div>
    <ul class="nav-menu">
        <li class="user-info">
            {{ request.user.username }}
        </li>
        <li>
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="logout-btn">Keluar</button>
            </form>
        </li>
    </ul>
</nav>


<!-- Dashboard Content -->
<section class="dashboard">
    <h1>Dashboard</h1>
    <p class="subtitle">Selamat datang di sistem peminjaman.id</p>

    <div class="card-container">

        <a href="/barang/" class="card">
            <div class="card-number">{{ total_barang }}</div>
            <h2>Data Barang</h2>
            <p>Kelola daftar barang yang tersedia untuk dipinjam.</p>
        </a>

        <a href="/peminjaman/" class="card">
            <div class="card-number">{{ total_peminjaman }}</div>
            <h2>Data Peminjaman</h2>
            <p>Lihat dan kelola transaksi peminjaman barang.</p>
        </a>

        <a href="/penyimpanan/" class="card">
            <div class="card-number">{{ total_penyimpanan }}</div>
            <h2>Data Penyimpanan</h2>
            <p>Kelola barang yang disimpan</p>
        </a>

    </div>
    <div class="chart-wrapper">
        <div class="chart-grid">

            <!-- PIE CHART -->
            <div class="chart-box">
                <h2>Perbandingan Data (%)</h2>
                <canvas id="dashboardChart"></canvas>
            </div>

            <!-- BAR CHART -->
            <div class="chart-box">
                <h2>Perbandingan Data (½)</h2>
                <canvas id="barChart"></canvas>
            </div>

        </div>
    </div>


</section>

<!-- Footer -->
<footer class="footer">
    <p>© 2026 Primakara University</p>
</footer>

</body>
</html>
<script>
    const dataBarang = {{ total_barang }};
    const dataPeminjaman = {{ total_peminjaman }};
    const dataPenyimpanan = {{ total_penyimpanan }};

    const total = dataBarang + dataPeminjaman + dataPenyimpanan;

    /* PIE CHART */
    new Chart(document.getElementById('dashboardChart'), {
        type: 'pie',
        data: {
            labels: ['Barang', 'Peminjaman', 'Penyimpanan'],
            datasets: [{
                data: [dataBarang, dataPeminjaman, dataPenyimpanan],
                backgroundColor: ['#2563eb', '#f59e0b', '#10b981']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(ctx) {
                            const value = ctx.raw;
                            const percent = ((value / total) * 100).toFixed(1);
                            return `${ctx.label}: ${percent}%`;
                        }
                    }
                },
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    /* BAR CHART */
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: ['Barang', 'Peminjaman', 'Penyimpanan'],
            datasets: [{
                label: 'Jumlah Data',
                data: [dataBarang, dataPeminjaman, dataPenyimpanan],
                backgroundColor: ['#2563eb', '#f59e0b', '#10b981']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
</script>